<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>
    <p>Connection state: <span id="connState"></span></p>
    <pre id="state">
      empty
    </pre>
    <button id="connect">Присоединиться</button>
    <button id="start">Начать голосование</button>
    <button id="setVote">Проголосовать</button>
    <button id="stop">Завершить голосование</button>
    <script>
      let ws;

      $("#connect").click(() => {
        ws = new WebSocket("ws://localhost:3001");
        ws.onopen = async () => {
          $("#connState").html("Online");
          await ws.send(
            JSON.stringify(
              {
                method: "CONNECT_TO_TEAM",
                teamId: "Nm0xzRhRQ",
                token:
                  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI1ZTY2NzAyYTI2ODNkNTE0ZjRkYzA4YjciLCJpYXQiOjE1ODQ4NzY0NDIsImV4cCI6MTU4NDg4MDA0Mn0.5Zd87_Z7T19pwCBacnKULRo60Wf6k4AsAJQI-FCe64k"
              },
              true
            )
          );
        };
        ws.onmessage = data => {
          try {
            console.log(data);
            console.log(JSON.parse(data.data), true);
            $("#state").html(data);
          } catch (error) {
            $("#state").html(error);
          }
        };
        ws.onclose = () => {
          $("#connState").html("Offline");
        };
      });

      $("#start").click(() => {
        ws.send(
          JSON.stringify({
            method: "START_VOTING",
            token:
              "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI1ZTY2NzAyYTI2ODNkNTE0ZjRkYzA4YjciLCJpYXQiOjE1ODQ4NzY0NDIsImV4cCI6MTU4NDg4MDA0Mn0.5Zd87_Z7T19pwCBacnKULRo60Wf6k4AsAJQI-FCe64k",
            teamId: "Nm0xzRhRQ"
          })
        );
      });

      $("#setVote").click(() => {
        ws.send(
          JSON.stringify({
            method: "SET_VOTE_VALUE",
            token:
              "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI1ZTY2NzAyYTI2ODNkNTE0ZjRkYzA4YjciLCJpYXQiOjE1ODQ4NzY0NDIsImV4cCI6MTU4NDg4MDA0Mn0.5Zd87_Z7T19pwCBacnKULRo60Wf6k4AsAJQI-FCe64k",
            teamId: "Nm0xzRhRQ",
            voteValue: 3
          })
        );
      });

      $("#stop").click(() => {
        ws.send(
          JSON.stringify({
            method: "STOP_VOTING",
            token:
              "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI1ZTY2NzAyYTI2ODNkNTE0ZjRkYzA4YjciLCJpYXQiOjE1ODQ4NzI3MzEsImV4cCI6MTU4NDg3NjMzMX0.j22Zl5IATSUFLDngzpMqV8T915p6IOGlOD0F_gQhJ-c",
            teamId: "Nm0xzRhRQ"
          })
        );
      });

      // ws.onmessage = data => {
      //   try {
      //     console.log(JSON.parse(data, true));
      //   } catch (error) {
      //     console.log(data);
      //   }
      // };
    </script>
  </body>
</html>
